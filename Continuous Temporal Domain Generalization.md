# Continuous Temporal Domain Generalization

## 解决的问题

传统方法假设领域数据收集离散，无法应对数据分布在连续时间上的变化。然而在现实中，**领域数据的观测并不总是在离散、规律的时间点上，而是随机且稀疏地分布在连续时间轴上**。

提出**连续时域泛化**（Continuous Temporal Domain Generalization, CTDG）任务，观测和未观测的领域均分布于连续时间轴上随机的时间点。

## Approach

![image-20250304203043368](https://houxiong-pictures.oss-cn-beijing.aliyuncs.com/image-20250304203043368.png)

CTDG problem 的三个潜在问题：

- **如何建模数据动态并同步模型动态**
  CTDG要求在连续时间轴上捕捉领域数据的动态，并据此同步调整模型状态。然而，数据动态本身难以直接观测，需要通过观测时间点来学习。此外，模型动态的演变过程也同样复杂。理解数据演变如何驱动模型演变构成了CTDG的首要挑战。
- **如何在高度非线性模型动态中捕捉主动态**
  领域数据的预测模型通常依赖过参数化（over-parametrized）的深度神经网络，模型动态因此呈现出高维、非线性的复杂特征。这导致模型的主动态嵌藏在大量潜在维度中。如何有效提取并将这些主动态映射到可学习的空间，是CTDG任务中的另一重大挑战。
- **如何确保长期泛化的稳定性和可控性**
  为实现未来任意时刻的泛化，CTDG必须确保模型的长期稳定性。此外，在许多情况下，我们可能拥有数据动态的高层次先验知识。如何将这些先验知识嵌入CTDG的优化过程中，进而提升泛化的稳定性和可控性，是一个重要的开放性问题。

### 问题一：建模数据动态并同步模型动态

- **假设**：数据分布在时间上具有连续演化的特性，即$P_t(Y|X)$随时间平滑变化，动态演化规律有函数$f$描述。

- **理论**：此假设的前提下，predictive model $g(·;\theta_t)$的参数$\theta_t$也会随时间continuously变化，其动态演化过程被模型的当前状态和$f$描述，即模型和数据分布。$\theta_t$满足：
  $$
  \frac{d\theta_t}{dt}=J_g(\theta_t)^{-1}f(g(·;\theta_t),t)
  $$

由于$f$不可知具体形式，解不出这个微分方程，所以，用可学习的函数$h(\theta_t,t;\phi)$来描述参数变化，设定以下优化目标：
$$
\phi=argmin_\phi\sum_{i=1}^T\sum_{j=1}^i||\theta_i-\theta_i^{j\rightarrow i}||_2 \\
\theta_i^{j\rightarrow i}=\theta_j+\int_{t_j}^{t_i}h(\theta_\tau,\tau;\phi)d\tau
$$

### 问题二：在高度非线性模型动态中捕捉主动态

用**库普曼理论**（Koopman Theory）来简化复杂的模型动态，将动态$h$在高维空间的非线性动态转为低维线性动态。

库普曼嵌入函数：$\varphi$高维参数空间映射到低维库普曼空间：
$$
z=\varphi(\theta)
$$
由库普曼算子：
$$
\frac{dz}{dt}=\mathcal{K}z
$$
在库普曼空间更新参数再将其映射回原本空间：
$$
z_i^{j\rightarrow i}=z_j+\int_{t_i}^{t_j}\mathcal{K}z_\tau d\tau\\
\theta^{j\rightarrow i}=\varphi^{-1}(z_i^{z_i^{j\rightarrow i}})
$$

### 问题三：联合优化与先验知识结合

对多个组件同时施加约束确保模型能够稳定泛化：

- 预测准确性：通过最小化预测误差，使预测模型在每个观测时间点都能准确预测实际数据。
- 泛化准确性：通过最小化预测误差，使泛化模型在每个观测时间点都能准确预测实际数据。
- 重构一致性：确保模型参数在原始空间与库普曼空间之间的转换具有一致性。
- 动态保真性：约束库普曼空间的动态行为，使得映射后的空间符合预期的动态系统特征。
- 参数一致性：确保泛化模型参数映射回原始空间后与预测模型参数保持一致。

通过库普曼算子的谱特性来评估模型的长期稳定性，**利用库普曼算子评估和控制泛化过程**。

观察库普曼算子的特征值，可以判断系统是否稳定：

- 若所有特征值实部为负，系统会稳定地趋向于一个平衡状态。
- 若存在特征值实部为正，系统将变得不稳定，模型在未来可能会崩塌。
- 若特征值实部为零，系统可能表现出周期性行为。

可以通过对库普曼算子施加显式约束来调控模型的动态行为：

- 当数据动态为周期性时，可将库普曼算子$\mathcal{K}$ 设为反对称矩阵，使其特征值为纯虚数，从而使模型表现出周期性行为。
- 低秩近似：将 $\mathcal{K}$ 表示为低秩矩阵，有助于控制模型的自由度，避免过拟合到次要信息。